<!DOCTYPE 
    html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"
>

<html 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns="http://www.w3.org/1999/html" 
    lang="en" 
    xml:lang="en"
>

<head>
    
    <title> Tefpay | Pasarela de pago </title>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Tefpay | Pasarela de pago"/>
    <meta name="author" content="Tefpay"/>
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>

    <!--favicon-->
    <link rel="shortcut icon"   type="image/x-icon" href="img/00999999999/favicon1.ico" />

    <!-- Bootstrap core CSS -->
    <link href="css/00999999999/bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet"/>

    <!-- Custom styles for this template -->
    <!-- <link href="./css/00999999999/sticky-footer-navbar.css?v=1.3" type="text/css" rel="stylesheet"/> -->

    <!--font-awesome-->
    <link rel="stylesheet" type="text/css" href="css/00999999999/font-awesome/css/all.css"/>

    <!-- Custome Css -->
    <link rel="stylesheet" type="text/css"  href="css/00999999999/main.css" />

 
</head>
<body style="margin:0px;">


<!-- Begin page content -->
<div id="wrapper" class="container-fluid">

    <div class="row">
        
        <div class="col-md-12">
            
            <!-- CAMPO NUMERO DE TARGETA -->
            <div class="form-group has-feedback" id="PanBox" >
                <div class="input-icon">
                    
                    <i class="fa fa-credit-card mr-1"></i>
                    <input 
                        type="text" 
                        class="form-control" 
                        id="Ds_Merchant_PanMask" 
                        autocomplete="off" 
                        placeholder="{MSG31}" 
                    />

                </div>

                <small class="my-1 px-2 text-secondary">
                    {MSG31}
                </small>
                <p class="help-block small hidden">&nbsp;&nbsp;{MSG48}</p>
            </div>

            <!-- CAMPOS DE FECHA Y CVV -->
            <div class="form-group has-feedback">

                <div class="row">
                    <div class="col-md-8">
                        <div class="row" id="ExpiryBox">
                            <div class="col-4 col-xs-4 col-md-4 col-lg-4">
                                
                                <div class="input-icon">
                                    
                                    <i class="fa fa-calendar"></i>
                                    <select 
                                        class="form-control text-muted" 
                                        id="Ds_Merchant_PanMonth" 
                                        name="month_start"
                                    >
                                        <option selected disabled value="Mes">
                                            {MSG46}
                                        </option>
                                        <option>01</option>
                                        <option>02</option>
                                        <option>03</option>
                                        <option>04</option>
                                        <option>05</option>
                                        <option>06</option>
                                        <option>07</option>
                                        <option>08</option>
                                        <option>09</option>
                                        <option>10</option>
                                        <option>11</option>
                                        <option>12</option>
                                    </select>
                                </div>
                    
                                <small class="my-1 px-2 text-secondary">
                                    {MSG46}
                                </small>
                                
                            </div>
                                                
                            <div class="col-4 col-xs-4 col-md-4 col-lg-4">
                                
                                <span class="divider_bar"></span>
                    
                                <div class="input-icon">
                                    
                                    <i class="fa fa-calendar"></i>
                                    <select 
                                        class="form-control text-muted" 
                                        id="Ds_Merchant_PanYear" 
                                        name="year_start">
                                    </select>
                    
                                </div>
                                <small class="my-1 px-2 text-secondary">
                                    {MSG47}
                                </small>
                            </div>  

                            <div class="col-4 col-xs-4 col-md-4 col-lg-4" id="CvvBox">
                        
                                <span class="divider_minus"></span>
        
                                <div class="input-icon">
                                    
                                    <i class="fa fa-lock"></i>
                                    <input 
                                        id="Ds_Cvv2" 
                                        placeholder="{MSG19}" 
                                        class="form-control" 
                                        type="text" 
                                        autocomplete="off" 
                                        maxlength="4" 
                                    />
        
                                </div>
        
                                <small class="my-1 px-2 text-secondary">
                                    {MSG19}
                                </small>
                                <p class="help-block small hidden">&nbsp;&nbsp;{MSG50}</p>
                            </div>

                        </div>
                    </div>
                    
                </div>

            </div>

            <!-- BOTON DE PAGO -->
            <button id="Ds_Merchant_PayButton" type="button" class="btn btn-primary btn-lg btn-block m-auto my-4 d-flex">
                {MSG12}
            </button>
        
        </div>  


        <!-- Tefpay messages -->
        <div class="modal fade" id="tefpaymsg" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="row borders">
                            <div class="col-xs-7 col-lg-1 modelcol">
                                <i id="tefpaymsg-title-icon" class="fa"></i>
                            </div>
                            <div class="col-xs-7 col-lg-10 modelcol">
                                <p id="tefpaymsg-title-text" class="modal-title h4"></p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-body">
                        <p id="tefpaymsg-text" class="text-left"></p>
                    </div>
                    <div class="modal-footer">
                        <button id="Ds_Merchant_PayResults" type="button" class="btn btn-primary btn-lg" data-dismiss="modal">{MSG24}</button>
                    </div>
                </div>
            </div>
        </div> <!-- Tefpay messages !-->

    </div>

</div> <!-- /container -->


<!-- jQuery -->
<script src="js/00999999999/jquery.min.js" type="text/javascript" ></script>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript" src="js/00999999999/js/bootstrap.min.js"></script>

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script type="text/javascript" src="js/00999999999/ie10-viewport-bug-workaround.js"></script>

<!-- Tefpay -->
<script type="text/javascript">

    $(document).ready(function() {

        // Inicializamos los pagos
        Tefpay.init();

        $("#Ds_Merchant_PayButton").click(function(){

            // Validamos los datos necessarios para realizar el pago
            var validation = Tefpay.validate(false);

            switch (validation) {
                case -1: // Targeta incorrecta
                    $("#PanBox").addClass("has-error").find("input").focus().parent().children("p").removeClass("hidden");
                    alert($("<div/>").html("{MSG32}").text());
                    sendHeight();
                    break;
                case -2: // CVV Incorrecto
                    $("#CvvBox").addClass("has-error").find("input").focus().parent().parent().find(".hidden").removeClass("hidden");
                    sendHeight();
                    alert($("<div/>").html("{MSG10}").text());
                    break;
                case -3: // Caducidad incorrecta
                    $("#ExpiryBox").addClass("has-error").find("div select").first().focus().parent().parent().find("p.hidden").removeClass("hidden");
                    sendHeight();
                    alert($("<div/>").html("{MSG34}").text());
                    break;
                case 1:
                    // Lanzamos el cobro.
                    var data = new Object();
                    data.Ds_Merchant_MerchantCode = "[Ds_Merchant_MerchantCode]";
                    data.action = "pay";

                    Tefpay.execute({
                        data: data,
                        success: function(response) {

                            $("#tefpaymsg-title-icon").attr('class', 'fa fa-check fa-2x').css('color', 'green');
                            $("#tefpaymsg-title-text").html("{MSG22}");
                            $("#tefpaymsg-text").attr('class', 'text-success').html("{MSG23}");
                            $('#Ds_Merchant_PayResults').html("{MSG24}").prop('disabled', false);
                        },
                        fail: function(response) {

                            $("#tefpaymsg-title-icon").attr('class', 'fa fa-times fa-2x').css('color', 'red');
                            $("#tefpaymsg-title-text").html("{MSG22}");
                            $("#tefpaymsg-text").attr('class', 'text-danger').html("{MSG27}" + " ({MSG28}: " + response.transaction.Ds_Code + ")" );
                            $('#Ds_Merchant_PayResults').html("{MSG25}").prop('disabled', false);
                        },
                        error: function(response) {

                            $("#tefpaymsg-title-icon").attr('class', 'fa fa-times fa-2x').css('color', 'red');
                            $("#tefpaymsg-title-text").html("{MSG22}");
                            $("#tefpaymsg-text").attr('class', 'text-danger').html("{MSG26}");
                            $('#Ds_Merchant_PayResults').html("{MSG25}").prop('disabled', false);
                        }
                    });
                    $('#tefpaymsg').modal('show');
                    break;
            }
        });

        $("#Ds_Merchant_PayResults").click(function() {
            Tefpay.redirect();
        });

        $('#tefpaymsg').on('show.bs.modal', function (event) {

            var modal = $(this);
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever') // Extract info from data-* attributes

            $("#tefpaymsg-title-icon").attr('class', 'fa fa-circle-o-notch fa-spin fa-2x').css('color', 'black');
            $("#tefpaymsg-title-text").html("{MSG21}...");

            $("#tefpaymsg-text").attr('class', 'text-info').html("{MSG20}...");
            $('#Ds_Merchant_PayResults').html("{MSG29}...").prop('disabled', true);

        });

        var d = new Date();
        var yoptions = "<option disabled selected>{MSG47}<\/option>";
        for (var x=d.getFullYear(); x != d.getFullYear() + 10; x++) {
            yoptions += "<option>"+x+"<\/option>";
        }
        
        $("#Ds_Merchant_PanYear").html(yoptions);

        $( "#Ds_Merchant_PanMask" ).bind( "focus", function() {
            $( "#Ds_Merchant_PanMask" ).bind( "keypress", function() {
                $("#PanBox").removeClass("has-error").find("input").parent().children("p").addClass("hidden");
                $( "#Ds_Merchant_PanMask" ).unbind( "keypress");
            });
        });

        $( "#Ds_Cvv2" ).bind( "focus", function() {
            $( "#Ds_Cvv2" ).bind( "keypress", function() {
                $("#CvvBox").removeClass("has-error").find(".help-block").addClass("hidden");
                $( "#Ds_Cvv2" ).unbind( "keypress");
            });
        });

        $( "#Ds_Merchant_PanMonth" ).bind( "change", function() {
            if ($.isNumeric($( this ).val()) && $.isNumeric($("#Ds_Merchant_PanYear").val()) )
                $("#ExpiryBox").removeClass("has-error").find("p.help-block").addClass("hidden");
        });
        $( "#Ds_Merchant_PanYear" ).bind( "change", function() {
            if ($.isNumeric($( this ).val()) && $.isNumeric($("#Ds_Merchant_PanMonth").val()) )
                $("#ExpiryBox").removeClass("has-error").find("p.help-block").addClass("hidden");
        });

        // Preparamos eventos
        var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
        var eventer = window[eventMethod];
        var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
        eventer(messageEvent, function(e) {
                    if (isNaN(e.data)) return;
                    sendHeight();
                },
                false);
        // Refresco una vez cargada la pagina.
        sendHeight();
    });

</script>

<script type="text/javascript">
    function sendHeight() {
        if(parent.postMessage)
        {
            var height= document.getElementById('wrapper').offsetHeight;
            parent.postMessage(height, '*');
        }
    }
</script>

</body>
</html>
